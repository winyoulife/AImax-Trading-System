<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX API 測試 - 根據 ChatGPT 建議</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .price { font-size: 2em; color: #00b894; text-align: center; margin: 20px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🧪 MAX API 測試 - 根據 ChatGPT 建議</h1>
    <p>測試 ChatGPT 提供的 MAX API v2 端點：<code>https://max-api.maicoin.com/api/v2/tickers/btctwd</code></p>
    
    <div id="results"></div>
    
    <script>
        async function testMaxAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result">🔄 開始測試...</div>';
            
            let html = '';
            
            // 測試 1: 直接連接 MAX API v2
            html += '<h3>🧪 測試 1: 直接連接 MAX API v2</h3>';
            try {
                const response = await fetch('https://max-api.maicoin.com/api/v2/tickers/btctwd', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('MAX API v2 直接連接響應:', data);
                    
                    // 根據實際格式解析（直接有 last 字段）
                    const price = parseFloat(data.last);
                    
                    if (price && price > 0) {
                        html += `<div class="result success">
                            ✅ <strong>直接連接成功</strong><br>
                            💰 BTC/TWD 價格: NT$${price.toLocaleString()}<br>
                            📊 完整數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                        
                        // 顯示價格
                        html = `<div class="price">💰 BTC/TWD: NT$${price.toLocaleString()}</div>` + html;
                    } else {
                        html += `<div class="result error">
                            ❌ <strong>價格解析失敗</strong><br>
                            📊 原始數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    }
                } else {
                    html += `<div class="result error">
                        ❌ <strong>HTTP 錯誤</strong><br>
                        狀態碼: ${response.status}<br>
                        狀態文字: ${response.statusText}
                    </div>`;
                }
            } catch (error) {
                html += `<div class="result error">
                    ❌ <strong>直接連接失敗 (CORS 錯誤)</strong><br>
                    錯誤信息: ${error.message}
                </div>`;
                console.error('直接連接錯誤:', error);
            }
            
            // 測試 2: 使用 CORS 代理
            html += '<h3>🧪 測試 2: 使用 CORS 代理 (allorigins.win)</h3>';
            try {
                const corsUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://max-api.maicoin.com/api/v2/tickers/btctwd');
                const response = await fetch(corsUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('CORS 代理響應:', data);
                    
                    const price = parseFloat(data.last);
                    
                    if (price && price > 0) {
                        html += `<div class="result success">
                            ✅ <strong>CORS 代理成功</strong><br>
                            💰 BTC/TWD 價格: NT$${price.toLocaleString()}<br>
                            📊 完整數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    } else {
                        html += `<div class="result error">
                            ❌ <strong>CORS 代理價格解析失敗</strong><br>
                            📊 原始數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    }
                } else {
                    html += `<div class="result error">
                        ❌ <strong>CORS 代理 HTTP 錯誤</strong><br>
                        狀態碼: ${response.status}
                    </div>`;
                }
            } catch (error) {
                html += `<div class="result error">
                    ❌ <strong>CORS 代理失敗</strong><br>
                    錯誤信息: ${error.message}
                </div>`;
                console.error('CORS 代理錯誤:', error);
            }
            
            // 測試 3: 使用另一個 CORS 代理
            html += '<h3>🧪 測試 3: 使用 CORS 代理 (corsproxy.io)</h3>';
            try {
                const corsUrl2 = 'https://corsproxy.io/?' + encodeURIComponent('https://max-api.maicoin.com/api/v2/tickers/btctwd');
                const response = await fetch(corsUrl2);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('CORS 代理 2 響應:', data);
                    
                    const price = parseFloat(data.last);
                    
                    if (price && price > 0) {
                        html += `<div class="result success">
                            ✅ <strong>CORS 代理 2 成功</strong><br>
                            💰 BTC/TWD 價格: NT$${price.toLocaleString()}<br>
                            📊 完整數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    } else {
                        html += `<div class="result error">
                            ❌ <strong>CORS 代理 2 價格解析失敗</strong><br>
                            📊 原始數據: <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    }
                } else {
                    html += `<div class="result error">
                        ❌ <strong>CORS 代理 2 HTTP 錯誤</strong><br>
                        狀態碼: ${response.status}
                    </div>`;
                }
            } catch (error) {
                html += `<div class="result error">
                    ❌ <strong>CORS 代理 2 失敗</strong><br>
                    錯誤信息: ${error.message}
                </div>`;
                console.error('CORS 代理 2 錯誤:', error);
            }
            
            html += `<div class="result">
                <h3>📋 總結</h3>
                <p>根據 ChatGPT 的建議，MAX API v2 端點是正確的。</p>
                <p>如果直接連接失敗，通常是因為 CORS 限制，需要使用代理服務。</p>
                <p>實際的 API 格式是直接返回字段，而不是包在 ticker 對象中。</p>
            </div>`;
            
            resultsDiv.innerHTML = html;
        }
        
        // 頁面載入後執行測試
        document.addEventListener('DOMContentLoaded', testMaxAPI);
        
        // 添加重新測試按鈕
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.createElement('button');
            button.textContent = '🔄 重新測試';
            button.style.cssText = 'padding: 10px 20px; background: #6c5ce7; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 20px 0;';
            button.onclick = testMaxAPI;
            document.body.insertBefore(button, document.getElementById('results'));
        });
    </script>
</body>
</html>