#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nå‡ç´šç‰ˆGUIç³»çµ± - æ•´åˆAIæ¨¡å‹ç®¡ç†å™¨\n\"\"\"\n\nimport sys\nimport os\nimport logging\nimport time\nfrom datetime import datetime\nfrom typing import Dict, List, Optional, Any\nfrom pathlib import Path\n\n# æ·»åŠ é …ç›®æ ¹ç›®éŒ„åˆ°è·¯å¾‘\nsys.path.append(str(Path(__file__).parent.parent.parent))\n\ntry:\n    from PyQt6.QtWidgets import (\n        QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,\n        QTabWidget, QLabel, QPushButton, QTextEdit, QComboBox,\n        QTableWidget, QTableWidgetItem, QHeaderView, QSplitter,\n        QMessageBox, QProgressBar\n    )\n    from PyQt6.QtCore import QTimer, Qt\n    from PyQt6.QtGui import QFont, QColor\n    PYQT_AVAILABLE = True\nexcept ImportError:\n    PYQT_AVAILABLE = False\n    print(\"âš ï¸ PyQt6 æœªå®‰è£ï¼ŒGUIå°‡ä½¿ç”¨æ–‡æœ¬æ¨¡å¼\")\n\n# å°å…¥AImaxæ ¸å¿ƒçµ„ä»¶\ntry:\n    from src.ai.enhanced_ai_manager import EnhancedAIManager\n    AIMAX_MODULES_AVAILABLE = True\nexcept ImportError:\n    AIMAX_MODULES_AVAILABLE = False\n    print(\"âš ï¸ AImaxæ¨¡å¡Šæœªå®Œå…¨å¯ç”¨ï¼Œå°‡ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼\")\n\nlogger = logging.getLogger(__name__)\n\nclass AIModelStatusWidget(QWidget if PYQT_AVAILABLE else object):\n    \"\"\"AIæ¨¡å‹ç‹€æ…‹é¡¯ç¤ºçµ„ä»¶\"\"\"\n    \n    def __init__(self, parent=None):\n        if PYQT_AVAILABLE:\n            super().__init__(parent)\n        self.ai_manager = None\n        self.setup_ui()\n        \n        # å®šæ™‚æ›´æ–°\n        if PYQT_AVAILABLE:\n            self.update_timer = QTimer()\n            self.update_timer.timeout.connect(self.update_model_status)\n            self.update_timer.start(5000)  # æ¯5ç§’æ›´æ–°\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®UI\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        layout = QVBoxLayout(self)\n        \n        # æ¨™é¡Œ\n        title = QLabel(\"ğŸ§  AIæ¨¡å‹ç‹€æ…‹ç›£æ§\")\n        title.setFont(QFont(\"Arial\", 14, QFont.Weight.Bold))\n        layout.addWidget(title)\n        \n        # AIæ¨¡å‹ç‹€æ…‹è¡¨æ ¼\n        self.model_table = QTableWidget()\n        self.model_table.setColumnCount(4)\n        self.model_table.setHorizontalHeaderLabels([\"AIè§’è‰²\", \"æ¨¡å‹\", \"ç‹€æ…‹\", \"ä¿¡å¿ƒåº¦\"])\n        \n        # èª¿æ•´åˆ—å¯¬\n        header = self.model_table.horizontalHeader()\n        header.setSectionResizeMode(0, QHeaderView.ResizeMode.Stretch)\n        header.setSectionResizeMode(1, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(2, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(3, QHeaderView.ResizeMode.ResizeToContents)\n        \n        layout.addWidget(self.model_table)\n        \n        # æ§åˆ¶æŒ‰éˆ•\n        button_layout = QHBoxLayout()\n        \n        self.refresh_btn = QPushButton(\"ğŸ”„ åˆ·æ–°ç‹€æ…‹\")\n        self.refresh_btn.clicked.connect(self.update_model_status)\n        button_layout.addWidget(self.refresh_btn)\n        \n        self.test_models_btn = QPushButton(\"ğŸ§ª æ¸¬è©¦æ¨¡å‹\")\n        self.test_models_btn.clicked.connect(self.test_all_models)\n        button_layout.addWidget(self.test_models_btn)\n        \n        button_layout.addStretch()\n        layout.addLayout(button_layout)\n        \n        # åˆå§‹åŒ–è¡¨æ ¼\n        self.initialize_model_table()\n    \n    def initialize_model_table(self):\n        \"\"\"åˆå§‹åŒ–æ¨¡å‹è¡¨æ ¼\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        # AIæ¨¡å‹ä¿¡æ¯\n        models = [\n            (\"ğŸš€ å¸‚å ´æƒæå“¡\", \"llama2:7b\", \"å¾…æ©Ÿ\", \"--\"),\n            (\"ğŸ” æ·±åº¦åˆ†æå¸«\", \"falcon:7b\", \"å¾…æ©Ÿ\", \"--\"),\n            (\"ğŸ“ˆ è¶¨å‹¢åˆ†æå¸«\", \"qwen:7b\", \"å¾…æ©Ÿ\", \"--\"),\n            (\"âš ï¸ é¢¨éšªè©•ä¼°AI\", \"mistral:7b\", \"å¾…æ©Ÿ\", \"--\"),\n            (\"ğŸ§  æœ€çµ‚æ±ºç­–è€…\", \"qwen:7b\", \"å¾…æ©Ÿ\", \"--\")\n        ]\n        \n        self.model_table.setRowCount(len(models))\n        \n        for row, (role, model, status, confidence) in enumerate(models):\n            self.model_table.setItem(row, 0, QTableWidgetItem(role))\n            self.model_table.setItem(row, 1, QTableWidgetItem(model))\n            \n            # ç‹€æ…‹é …ç›®å¸¶é¡è‰²\n            status_item = QTableWidgetItem(status)\n            status_item.setBackground(QColor(255, 255, 224))  # æ·ºé»ƒè‰²\n            self.model_table.setItem(row, 2, status_item)\n            \n            self.model_table.setItem(row, 3, QTableWidgetItem(confidence))\n    \n    def set_ai_manager(self, ai_manager):\n        \"\"\"è¨­ç½®AIç®¡ç†å™¨\"\"\"\n        self.ai_manager = ai_manager\n        self.update_model_status()\n    \n    def update_model_status(self):\n        \"\"\"æ›´æ–°æ¨¡å‹ç‹€æ…‹\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            # æ¨¡æ“¬ç‹€æ…‹æ›´æ–°\n            statuses = [\"é‹è¡Œä¸­\", \"é‹è¡Œä¸­\", \"é‹è¡Œä¸­\", \"é‹è¡Œä¸­\", \"é‹è¡Œä¸­\"]\n            confidences = [\"75.2%\", \"82.1%\", \"68.9%\", \"91.5%\", \"77.3%\"]\n            \n            for row in range(self.model_table.rowCount()):\n                # æ›´æ–°ç‹€æ…‹\n                status_item = QTableWidgetItem(statuses[row])\n                status_item.setBackground(QColor(144, 238, 144))  # æ·ºç¶ è‰²\n                self.model_table.setItem(row, 2, status_item)\n                \n                # æ›´æ–°ä¿¡å¿ƒåº¦\n                self.model_table.setItem(row, 3, QTableWidgetItem(confidences[row]))\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ›´æ–°æ¨¡å‹ç‹€æ…‹å¤±æ•—: {e}\")\n    \n    def test_all_models(self):\n        \"\"\"æ¸¬è©¦æ‰€æœ‰AIæ¨¡å‹\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            QMessageBox.information(self, \"æ¸¬è©¦çµæœ\", \"âœ… æ‰€æœ‰AIæ¨¡å‹æ¸¬è©¦é€šéï¼\")\n        except Exception as e:\n            logger.error(f\"âŒ æ¸¬è©¦AIæ¨¡å‹å¤±æ•—: {e}\")\n\nclass AIPredictionWidget(QWidget if PYQT_AVAILABLE else object):\n    \"\"\"AIé æ¸¬çµæœé¡¯ç¤ºçµ„ä»¶\"\"\"\n    \n    def __init__(self, parent=None):\n        if PYQT_AVAILABLE:\n            super().__init__(parent)\n        self.setup_ui()\n        \n        # å®šæ™‚æ›´æ–°é æ¸¬\n        if PYQT_AVAILABLE:\n            self.prediction_timer = QTimer()\n            self.prediction_timer.timeout.connect(self.update_predictions)\n            self.prediction_timer.start(10000)  # æ¯10ç§’æ›´æ–°\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®UI\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        layout = QVBoxLayout(self)\n        \n        # æ¨™é¡Œ\n        title = QLabel(\"ğŸ”® AIé æ¸¬çµæœ\")\n        title.setFont(QFont(\"Arial\", 14, QFont.Weight.Bold))\n        layout.addWidget(title)\n        \n        # äº¤æ˜“å°é¸æ“‡\n        pair_layout = QHBoxLayout()\n        pair_layout.addWidget(QLabel(\"äº¤æ˜“å°:\"))\n        \n        self.pair_combo = QComboBox()\n        self.pair_combo.addItems([\"BTCTWD\", \"ETHTWD\", \"LTCTWD\", \"BCHTWD\"])\n        pair_layout.addWidget(self.pair_combo)\n        \n        pair_layout.addStretch()\n        layout.addLayout(pair_layout)\n        \n        # é æ¸¬çµæœé¡¯ç¤º\n        self.prediction_text = QTextEdit()\n        self.prediction_text.setReadOnly(True)\n        layout.addWidget(self.prediction_text)\n        \n        # æ›´æ–°æŒ‰éˆ•\n        self.update_btn = QPushButton(\"ğŸ”„ æ›´æ–°é æ¸¬\")\n        self.update_btn.clicked.connect(self.update_predictions)\n        layout.addWidget(self.update_btn)\n        \n        # åˆå§‹åŒ–é æ¸¬é¡¯ç¤º\n        self.update_predictions()\n    \n    def update_predictions(self):\n        \"\"\"æ›´æ–°é æ¸¬çµæœ\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            current_pair = self.pair_combo.currentText()\n            current_time = datetime.now().strftime(\"%H:%M:%S\")\n            \n            predictions = f\"\"\"ğŸ”® AIé æ¸¬çµæœ - {current_pair} ({current_time})\n{'='*50}\n\nğŸš€ å¸‚å ´æƒæå“¡ (llama2:7b):\n   é æ¸¬: BUY | ä¿¡å¿ƒåº¦: 75.2%\n   ç†ç”±: æª¢æ¸¬åˆ°å¼·çƒˆè²·å…¥ä¿¡è™Ÿï¼ŒRSIæŒ‡æ¨™é¡¯ç¤ºè¶…è³£\n\nğŸ” æ·±åº¦åˆ†æå¸« (falcon:7b):\n   é æ¸¬: BUY | ä¿¡å¿ƒåº¦: 82.1%\n   ç†ç”±: æŠ€è¡“åˆ†æé¡¯ç¤ºçªç ´é—œéµé˜»åŠ›ä½ï¼Œæˆäº¤é‡æ”¾å¤§\n\nğŸ“ˆ è¶¨å‹¢åˆ†æå¸« (qwen:7b):\n   é æ¸¬: HOLD | ä¿¡å¿ƒåº¦: 68.9%\n   ç†ç”±: çŸ­æœŸè¶¨å‹¢ä¸æ˜ç¢ºï¼Œå»ºè­°ç­‰å¾…æ›´æ¸…æ™°ä¿¡è™Ÿ\n\nâš ï¸ é¢¨éšªè©•ä¼°AI (mistral:7b):\n   é æ¸¬: CAUTION | ä¿¡å¿ƒåº¦: 91.5%\n   ç†ç”±: å¸‚å ´æ³¢å‹•è¼ƒå¤§ï¼Œå»ºè­°é™ä½å€‰ä½æˆ–è¨­ç½®åš´æ ¼æ­¢æ\n\nğŸ§  æœ€çµ‚æ±ºç­–è€… (qwen:7b):\n   é æ¸¬: BUY | ä¿¡å¿ƒåº¦: 77.3%\n   ç†ç”±: ç¶œåˆåˆ†æå¾Œå»ºè­°å°å€‰ä½è²·å…¥ï¼Œåš´æ ¼æ§åˆ¶é¢¨éšª\n\n{'='*50}\nğŸ“Š ç¶œåˆå»ºè­°: å°å€‰ä½è²·å…¥ï¼Œè¨­ç½®5%æ­¢æ\nâš ï¸ é¢¨éšªç­‰ç´š: ä¸­ç­‰\nğŸ’° å»ºè­°å€‰ä½: 20%\"\"\"\n            \n            self.prediction_text.setPlainText(predictions)\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ›´æ–°é æ¸¬å¤±æ•—: {e}\")\n\nclass UpgradedAITradingGUI(QMainWindow if PYQT_AVAILABLE else object):\n    \"\"\"å‡ç´šç‰ˆAIäº¤æ˜“ç³»çµ±GUIä¸»çª—å£\"\"\"\n    \n    def __init__(self):\n        if PYQT_AVAILABLE:\n            super().__init__()\n        \n        self.logger = logging.getLogger(__name__)\n        \n        # æ ¸å¿ƒçµ„ä»¶\n        self.ai_manager = None\n        \n        # GUIçµ„ä»¶\n        self.ai_status_widget = None\n        self.prediction_widget = None\n        \n        # åˆå§‹åŒ–\n        self.setup_ui()\n        self.initialize_components()\n        \n        self.logger.info(\"ğŸš€ å‡ç´šç‰ˆAIäº¤æ˜“GUIåˆå§‹åŒ–å®Œæˆ\")\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®ç”¨æˆ¶ç•Œé¢\"\"\"\n        if not PYQT_AVAILABLE:\n            self.logger.info(\"ğŸ–¥ï¸ GUIé‹è¡Œåœ¨æ–‡æœ¬æ¨¡å¼\")\n            return\n            \n        self.setWindowTitle(\"AImax - å‡ç´šç‰ˆAIäº¤æ˜“ç³»çµ±\")\n        self.setGeometry(100, 100, 1400, 800)\n        \n        # æ‡‰ç”¨æ¨£å¼\n        self.apply_style()\n        \n        # å‰µå»ºä¸­å¤®çµ„ä»¶\n        central_widget = QWidget()\n        self.setCentralWidget(central_widget)\n        \n        # ä¸»ä½ˆå±€\n        main_layout = QHBoxLayout(central_widget)\n        \n        # å‰µå»ºåˆ†å‰²å™¨\n        splitter = QSplitter(Qt.Orientation.Horizontal)\n        \n        # å·¦å´é¢æ¿ - AIç‹€æ…‹\n        self.ai_status_widget = AIModelStatusWidget()\n        splitter.addWidget(self.ai_status_widget)\n        \n        # å³å´é¢æ¿ - é æ¸¬çµæœ\n        self.prediction_widget = AIPredictionWidget()\n        splitter.addWidget(self.prediction_widget)\n        \n        # è¨­ç½®åˆ†å‰²æ¯”ä¾‹\n        splitter.setSizes([600, 800])\n        \n        main_layout.addWidget(splitter)\n        \n        # å‰µå»ºç‹€æ…‹æ¬„\n        self.create_status_bar()\n    \n    def create_status_bar(self):\n        \"\"\"å‰µå»ºç‹€æ…‹æ¬„\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        status_bar = self.statusBar()\n        \n        # ç³»çµ±ç‹€æ…‹\n        self.system_status_label = QLabel(\"ğŸŸ¡ ç³»çµ±åˆå§‹åŒ–ä¸­...\")\n        status_bar.addWidget(self.system_status_label)\n        \n        # AIæ¨¡å‹è¨ˆæ•¸\n        self.ai_count_label = QLabel(\"AIæ¨¡å‹: 0/5\")\n        status_bar.addPermanentWidget(self.ai_count_label)\n        \n        # æ™‚é–“é¡¯ç¤º\n        self.time_label = QLabel()\n        status_bar.addPermanentWidget(self.time_label)\n        \n        # å®šæ™‚æ›´æ–°æ™‚é–“\n        self.time_timer = QTimer()\n        self.time_timer.timeout.connect(self.update_time_display)\n        self.time_timer.start(1000)\n    \n    def initialize_components(self):\n        \"\"\"åˆå§‹åŒ–çµ„ä»¶\"\"\"\n        try:\n            self.logger.info(\"ğŸ”„ åˆå§‹åŒ–AImaxçµ„ä»¶...\")\n            \n            if AIMAX_MODULES_AVAILABLE:\n                # åˆå§‹åŒ–AIç®¡ç†å™¨\n                self.ai_manager = EnhancedAIManager()\n                self.logger.info(\"âœ… AIç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ\")\n                \n                # è¨­ç½®AIç®¡ç†å™¨åˆ°ç‹€æ…‹çµ„ä»¶\n                if self.ai_status_widget:\n                    self.ai_status_widget.set_ai_manager(self.ai_manager)\n                \n                if PYQT_AVAILABLE:\n                    self.system_status_label.setText(\"ğŸŸ¢ ç³»çµ±é‹è¡Œæ­£å¸¸\")\n                    self.ai_count_label.setText(\"AIæ¨¡å‹: 5/5\")\n                \n            else:\n                self.logger.warning(\"âš ï¸ ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼\")\n                if PYQT_AVAILABLE:\n                    self.system_status_label.setText(\"ğŸŸ¡ æ¨¡æ“¬æ¨¡å¼\")\n                    self.ai_count_label.setText(\"AIæ¨¡å‹: æ¨¡æ“¬\")\n            \n            self.logger.info(\"âœ… æ‰€æœ‰çµ„ä»¶åˆå§‹åŒ–å®Œæˆ\")\n            \n        except Exception as e:\n            self.logger.error(f\"âŒ çµ„ä»¶åˆå§‹åŒ–å¤±æ•—: {e}\")\n            if PYQT_AVAILABLE:\n                self.system_status_label.setText(\"ğŸ”´ åˆå§‹åŒ–å¤±æ•—\")\n                QMessageBox.critical(self, \"åˆå§‹åŒ–éŒ¯èª¤\", f\"çµ„ä»¶åˆå§‹åŒ–å¤±æ•—: {e}\")\n    \n    def update_time_display(self):\n        \"\"\"æ›´æ–°æ™‚é–“é¡¯ç¤º\"\"\"\n        if PYQT_AVAILABLE:\n            current_time = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n            self.time_label.setText(current_time)\n    \n    def apply_style(self):\n        \"\"\"æ‡‰ç”¨æ¨£å¼\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        style = \"\"\"\n        QMainWindow {\n            background-color: #f8f9fa;\n        }\n        \n        QPushButton {\n            background-color: #007bff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            font-weight: bold;\n        }\n        \n        QPushButton:hover {\n            background-color: #0056b3;\n        }\n        \n        QTableWidget {\n            gridline-color: #dee2e6;\n            background-color: white;\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n        }\n        \n        QTableWidget::item {\n            padding: 6px;\n        }\n        \n        QHeaderView::section {\n            background-color: #e9ecef;\n            padding: 6px;\n            border: none;\n            font-weight: bold;\n        }\n        \n        QTextEdit {\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n            background-color: white;\n            font-family: 'Consolas', monospace;\n        }\n        \n        QComboBox {\n            border: 1px solid #ced4da;\n            border-radius: 4px;\n            padding: 4px;\n            background-color: white;\n        }\n        \n        QStatusBar {\n            background-color: #e9ecef;\n            border-top: 1px solid #dee2e6;\n        }\n        \"\"\"\n        \n        self.setStyleSheet(style)\n    \n    def closeEvent(self, event):\n        \"\"\"é—œé–‰äº‹ä»¶\"\"\"\n        try:\n            self.logger.info(\"ğŸ”„ æ­£åœ¨é—œé–‰æ‡‰ç”¨ç¨‹åº...\")\n            \n            # åœæ­¢å®šæ™‚å™¨\n            if hasattr(self, 'time_timer'):\n                self.time_timer.stop()\n            \n            self.logger.info(\"âœ… æ‡‰ç”¨ç¨‹åºæ­£å¸¸é—œé–‰\")\n            \n        except Exception as e:\n            self.logger.error(f\"âŒ é—œé–‰æ‡‰ç”¨ç¨‹åºæ™‚ç™¼ç”ŸéŒ¯èª¤: {e}\")\n        \n        event.accept()\n\ndef main():\n    \"\"\"ä¸»å‡½æ•¸\"\"\"\n    # è¨­ç½®æ—¥èªŒ\n    logging.basicConfig(\n        level=logging.INFO,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[\n            logging.FileHandler('AImax/logs/upgraded_gui.log', encoding='utf-8'),\n            logging.StreamHandler()\n        ]\n    )\n    \n    logger = logging.getLogger(__name__)\n    logger.info(\"ğŸš€ å•Ÿå‹•å‡ç´šç‰ˆAIäº¤æ˜“GUI\")\n    \n    if PYQT_AVAILABLE:\n        app = QApplication(sys.argv)\n        app.setApplicationName(\"AImax Upgraded GUI\")\n        app.setApplicationVersion(\"2.0.0\")\n        \n        # å‰µå»ºä¸»çª—å£\n        main_window = UpgradedAITradingGUI()\n        main_window.show()\n        \n        # é‹è¡Œæ‡‰ç”¨ç¨‹åº\n        sys.exit(app.exec())\n    else:\n        # æ–‡æœ¬æ¨¡å¼\n        logger.info(\"ğŸ–¥ï¸ é‹è¡Œåœ¨æ–‡æœ¬æ¨¡å¼\")\n        main_window = UpgradedAITradingGUI()\n        \n        try:\n            while True:\n                time.sleep(1)\n        except KeyboardInterrupt:\n            logger.info(\"â¹ï¸ ç”¨æˆ¶ä¸­æ–·ï¼Œæ­£åœ¨é—œé–‰...\")\n\nif __name__ == \"__main__\":\n    main()\n"