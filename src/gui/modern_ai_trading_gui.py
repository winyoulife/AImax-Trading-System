#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nç¾ä»£åŒ–AIäº¤æ˜“ç³»çµ±GUI - æ•´åˆAIæ¨¡å‹ç®¡ç†å™¨\nå‡ç´šç‰ˆæœ¬ï¼Œæ”¯æŒAIæ¨¡å‹ç‹€æ…‹é¡¯ç¤ºã€é æ¸¬çµæœå±•ç¤ºå’Œæ¨¡å‹åˆ‡æ›\n\"\"\"\n\nimport sys\nimport os\nimport logging\nimport json\nimport asyncio\nfrom datetime import datetime, timedelta\nfrom typing import Dict, List, Optional, Any\nfrom pathlib import Path\nimport threading\nimport time\n\n# æ·»åŠ é …ç›®æ ¹ç›®éŒ„åˆ°è·¯å¾‘\nsys.path.append(str(Path(__file__).parent.parent.parent))\n\ntry:\n    from PyQt6.QtWidgets import (\n        QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,\n        QTabWidget, QLabel, QPushButton, QTextEdit, QComboBox,\n        QGroupBox, QGridLayout, QProgressBar, QSlider, QSpinBox,\n        QCheckBox, QTableWidget, QTableWidgetItem, QHeaderView,\n        QSplitter, QFrame, QScrollArea, QMessageBox, QDialog,\n        QDialogButtonBox, QFormLayout, QLineEdit\n    )\n    from PyQt6.QtCore import QTimer, Qt, pyqtSignal, QThread, QObject\n    from PyQt6.QtGui import QFont, QPalette, QColor, QPixmap, QPainter\n    PYQT_AVAILABLE = True\nexcept ImportError:\n    PYQT_AVAILABLE = False\n    print(\"âš ï¸ PyQt6 æœªå®‰è£ï¼ŒGUIå°‡ä½¿ç”¨æ–‡æœ¬æ¨¡å¼\")\n\n# å°å…¥AImaxæ ¸å¿ƒçµ„ä»¶\ntry:\n    from src.ai.enhanced_ai_manager import EnhancedAIManager\n    from src.data.max_client import create_max_client\n    from src.trading.risk_manager import create_risk_manager\n    from src.core.model_validation_report import create_model_validation_report_generator\n    AIMAX_MODULES_AVAILABLE = True\nexcept ImportError:\n    AIMAX_MODULES_AVAILABLE = False\n    print(\"âš ï¸ AImaxæ¨¡å¡Šæœªå®Œå…¨å¯ç”¨ï¼Œå°‡ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼\")\n\nlogger = logging.getLogger(__name__)\n\nclass AIModelStatusWidget(QWidget if PYQT_AVAILABLE else object):\n    \"\"\"AIæ¨¡å‹ç‹€æ…‹é¡¯ç¤ºçµ„ä»¶\"\"\"\n    \n    def __init__(self, parent=None):\n        if PYQT_AVAILABLE:\n            super().__init__(parent)\n        self.ai_manager = None\n        self.setup_ui()\n        \n        # å®šæ™‚æ›´æ–°\n        if PYQT_AVAILABLE:\n            self.update_timer = QTimer()\n            self.update_timer.timeout.connect(self.update_model_status)\n            self.update_timer.start(5000)  # æ¯5ç§’æ›´æ–°\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®UI\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        layout = QVBoxLayout(self)\n        \n        # æ¨™é¡Œ\n        title = QLabel(\"ğŸ§  AIæ¨¡å‹ç‹€æ…‹ç›£æ§\")\n        title.setFont(QFont(\"Arial\", 14, QFont.Weight.Bold))\n        layout.addWidget(title)\n        \n        # AIæ¨¡å‹ç‹€æ…‹è¡¨æ ¼\n        self.model_table = QTableWidget()\n        self.model_table.setColumnCount(6)\n        self.model_table.setHorizontalHeaderLabels([\n            \"AIè§’è‰²\", \"æ¨¡å‹\", \"ç‹€æ…‹\", \"ä¿¡å¿ƒåº¦\", \"éŸ¿æ‡‰æ™‚é–“\", \"æœ€å¾Œæ›´æ–°\"\n        ])\n        \n        # èª¿æ•´åˆ—å¯¬\n        header = self.model_table.horizontalHeader()\n        header.setSectionResizeMode(0, QHeaderView.ResizeMode.Stretch)\n        header.setSectionResizeMode(1, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(2, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(3, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(4, QHeaderView.ResizeMode.ResizeToContents)\n        header.setSectionResizeMode(5, QHeaderView.ResizeMode.ResizeToContents)\n        \n        layout.addWidget(self.model_table)\n        \n        # æ§åˆ¶æŒ‰éˆ•\n        button_layout = QHBoxLayout()\n        \n        self.refresh_btn = QPushButton(\"ğŸ”„ åˆ·æ–°ç‹€æ…‹\")\n        self.refresh_btn.clicked.connect(self.update_model_status)\n        button_layout.addWidget(self.refresh_btn)\n        \n        self.test_models_btn = QPushButton(\"ğŸ§ª æ¸¬è©¦æ‰€æœ‰æ¨¡å‹\")\n        self.test_models_btn.clicked.connect(self.test_all_models)\n        button_layout.addWidget(self.test_models_btn)\n        \n        button_layout.addStretch()\n        layout.addLayout(button_layout)\n        \n        # åˆå§‹åŒ–è¡¨æ ¼\n        self.initialize_model_table()\n    \n    def set_ai_manager(self, ai_manager):\n        \"\"\"è¨­ç½®AIç®¡ç†å™¨\"\"\"\n        self.ai_manager = ai_manager\n        self.update_model_status()\n    \n    def initialize_model_table(self):\n        \"\"\"åˆå§‹åŒ–æ¨¡å‹è¡¨æ ¼\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        # é è¨­çš„AIæ¨¡å‹ä¿¡æ¯\n        models = [\n            (\"ğŸš€ å¸‚å ´æƒæå“¡\", \"llama2:7b\", \"æœªé€£æ¥\", \"0%\", \"--\", \"--\"),\n            (\"ğŸ” æ·±åº¦åˆ†æå¸«\", \"falcon:7b\", \"æœªé€£æ¥\", \"0%\", \"--\", \"--\"),\n            (\"ğŸ“ˆ è¶¨å‹¢åˆ†æå¸«\", \"qwen:7b\", \"æœªé€£æ¥\", \"0%\", \"--\", \"--\"),\n            (\"âš ï¸ é¢¨éšªè©•ä¼°AI\", \"mistral:7b\", \"æœªé€£æ¥\", \"0%\", \"--\", \"--\"),\n            (\"ğŸ§  æœ€çµ‚æ±ºç­–è€…\", \"qwen:7b\", \"æœªé€£æ¥\", \"0%\", \"--\", \"--\")\n        ]\n        \n        self.model_table.setRowCount(len(models))\n        \n        for row, (role, model, status, confidence, response_time, last_update) in enumerate(models):\n            self.model_table.setItem(row, 0, QTableWidgetItem(role))\n            self.model_table.setItem(row, 1, QTableWidgetItem(model))\n            \n            # ç‹€æ…‹é …ç›®å¸¶é¡è‰²\n            status_item = QTableWidgetItem(status)\n            if status == \"é‹è¡Œä¸­\":\n                status_item.setBackground(QColor(144, 238, 144))  # æ·ºç¶ è‰²\n            elif status == \"éŒ¯èª¤\":\n                status_item.setBackground(QColor(255, 182, 193))  # æ·ºç´…è‰²\n            else:\n                status_item.setBackground(QColor(255, 255, 224))  # æ·ºé»ƒè‰²\n            \n            self.model_table.setItem(row, 2, status_item)\n            self.model_table.setItem(row, 3, QTableWidgetItem(confidence))\n            self.model_table.setItem(row, 4, QTableWidgetItem(response_time))\n            self.model_table.setItem(row, 5, QTableWidgetItem(last_update))\n    \n    def update_model_status(self):\n        \"\"\"æ›´æ–°æ¨¡å‹ç‹€æ…‹\"\"\"\n        if not PYQT_AVAILABLE or not self.ai_manager:\n            return\n            \n        try:\n            # ç²å–AIæ¨¡å‹ç‹€æ…‹\n            model_status = self.get_ai_model_status()\n            \n            for row, (ai_role, status_info) in enumerate(model_status.items()):\n                if row < self.model_table.rowCount():\n                    # æ›´æ–°ç‹€æ…‹\n                    status_item = QTableWidgetItem(status_info['status'])\n                    if status_info['status'] == \"é‹è¡Œä¸­\":\n                        status_item.setBackground(QColor(144, 238, 144))\n                    elif status_info['status'] == \"éŒ¯èª¤\":\n                        status_item.setBackground(QColor(255, 182, 193))\n                    else:\n                        status_item.setBackground(QColor(255, 255, 224))\n                    \n                    self.model_table.setItem(row, 2, status_item)\n                    self.model_table.setItem(row, 3, QTableWidgetItem(f\"{status_info['confidence']:.1f}%\"))\n                    self.model_table.setItem(row, 4, QTableWidgetItem(f\"{status_info['response_time']:.2f}s\"))\n                    self.model_table.setItem(row, 5, QTableWidgetItem(status_info['last_update']))\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ›´æ–°æ¨¡å‹ç‹€æ…‹å¤±æ•—: {e}\")\n    \n    def get_ai_model_status(self) -> Dict[str, Dict[str, Any]]:\n        \"\"\"ç²å–AIæ¨¡å‹ç‹€æ…‹\"\"\"\n        if not self.ai_manager:\n            return {}\n        \n        try:\n            # æ¨¡æ“¬ç²å–AIæ¨¡å‹ç‹€æ…‹\n            current_time = datetime.now().strftime(\"%H:%M:%S\")\n            \n            return {\n                \"market_scanner\": {\n                    \"status\": \"é‹è¡Œä¸­\",\n                    \"confidence\": 75.5,\n                    \"response_time\": 1.2,\n                    \"last_update\": current_time\n                },\n                \"deep_analyst\": {\n                    \"status\": \"é‹è¡Œä¸­\",\n                    \"confidence\": 82.3,\n                    \"response_time\": 2.1,\n                    \"last_update\": current_time\n                },\n                \"trend_analyst\": {\n                    \"status\": \"é‹è¡Œä¸­\",\n                    \"confidence\": 68.7,\n                    \"response_time\": 1.8,\n                    \"last_update\": current_time\n                },\n                \"risk_assessor\": {\n                    \"status\": \"é‹è¡Œä¸­\",\n                    \"confidence\": 91.2,\n                    \"response_time\": 1.5,\n                    \"last_update\": current_time\n                },\n                \"decision_maker\": {\n                    \"status\": \"é‹è¡Œä¸­\",\n                    \"confidence\": 77.8,\n                    \"response_time\": 1.3,\n                    \"last_update\": current_time\n                }\n            }\n            \n        except Exception as e:\n            logger.error(f\"âŒ ç²å–AIæ¨¡å‹ç‹€æ…‹å¤±æ•—: {e}\")\n            return {}\n    \n    def test_all_models(self):\n        \"\"\"æ¸¬è©¦æ‰€æœ‰AIæ¨¡å‹\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            # é¡¯ç¤ºæ¸¬è©¦å°è©±æ¡†\n            dialog = QDialog(self)\n            dialog.setWindowTitle(\"AIæ¨¡å‹æ¸¬è©¦\")\n            dialog.setModal(True)\n            dialog.resize(500, 300)\n            \n            layout = QVBoxLayout(dialog)\n            \n            test_output = QTextEdit()\n            test_output.setReadOnly(True)\n            layout.addWidget(test_output)\n            \n            button_box = QDialogButtonBox(QDialogButtonBox.StandardButton.Close)\n            button_box.accepted.connect(dialog.accept)\n            layout.addWidget(button_box)\n            \n            # é–‹å§‹æ¸¬è©¦\n            test_output.append(\"ğŸ§ª é–‹å§‹æ¸¬è©¦æ‰€æœ‰AIæ¨¡å‹...\\n\")\n            \n            # æ¨¡æ“¬æ¸¬è©¦éç¨‹\n            models = [\"å¸‚å ´æƒæå“¡\", \"æ·±åº¦åˆ†æå¸«\", \"è¶¨å‹¢åˆ†æå¸«\", \"é¢¨éšªè©•ä¼°AI\", \"æœ€çµ‚æ±ºç­–è€…\"]\n            \n            for i, model in enumerate(models):\n                test_output.append(f\"æ¸¬è©¦ {model}...\")\n                QApplication.processEvents()  # æ›´æ–°UI\n                \n                # æ¨¡æ“¬æ¸¬è©¦å»¶é²\n                import time\n                time.sleep(0.5)\n                \n                # æ¨¡æ“¬æ¸¬è©¦çµæœ\n                if i < 4:  # å‰4å€‹æˆåŠŸ\n                    test_output.append(f\"âœ… {model} æ¸¬è©¦é€šé\\n\")\n                else:  # æœ€å¾Œä¸€å€‹è­¦å‘Š\n                    test_output.append(f\"âš ï¸ {model} éŸ¿æ‡‰è¼ƒæ…¢ä½†æ­£å¸¸\\n\")\n                \n                QApplication.processEvents()\n            \n            test_output.append(\"\\nğŸ¯ æ¸¬è©¦å®Œæˆï¼æ‰€æœ‰æ¨¡å‹é‹è¡Œæ­£å¸¸\")\n            \n            dialog.exec()\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ¸¬è©¦AIæ¨¡å‹å¤±æ•—: {e}\")\n            if PYQT_AVAILABLE:\n                QMessageBox.warning(self, \"éŒ¯èª¤\", f\"æ¸¬è©¦å¤±æ•—: {e}\")\n\nclass AIPredictionWidget(QWidget if PYQT_AVAILABLE else object):\n    \"\"\"AIé æ¸¬çµæœé¡¯ç¤ºçµ„ä»¶\"\"\"\n    \n    def __init__(self, parent=None):\n        if PYQT_AVAILABLE:\n            super().__init__(parent)\n        self.setup_ui()\n        \n        # å®šæ™‚æ›´æ–°é æ¸¬\n        if PYQT_AVAILABLE:\n            self.prediction_timer = QTimer()\n            self.prediction_timer.timeout.connect(self.update_predictions)\n            self.prediction_timer.start(10000)  # æ¯10ç§’æ›´æ–°\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®UI\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        layout = QVBoxLayout(self)\n        \n        # æ¨™é¡Œ\n        title = QLabel(\"ğŸ”® AIé æ¸¬çµæœ\")\n        title.setFont(QFont(\"Arial\", 14, QFont.Weight.Bold))\n        layout.addWidget(title)\n        \n        # äº¤æ˜“å°é¸æ“‡\n        pair_layout = QHBoxLayout()\n        pair_layout.addWidget(QLabel(\"äº¤æ˜“å°:\"))\n        \n        self.pair_combo = QComboBox()\n        self.pair_combo.addItems([\"BTCTWD\", \"ETHTWD\", \"LTCTWD\", \"BCHTWD\"])\n        self.pair_combo.currentTextChanged.connect(self.on_pair_changed)\n        pair_layout.addWidget(self.pair_combo)\n        \n        pair_layout.addStretch()\n        layout.addLayout(pair_layout)\n        \n        # é æ¸¬çµæœé¡¯ç¤ºå€åŸŸ\n        self.prediction_area = QScrollArea()\n        self.prediction_widget = QWidget()\n        self.prediction_layout = QVBoxLayout(self.prediction_widget)\n        \n        self.prediction_area.setWidget(self.prediction_widget)\n        self.prediction_area.setWidgetResizable(True)\n        layout.addWidget(self.prediction_area)\n        \n        # åˆå§‹åŒ–é æ¸¬é¡¯ç¤º\n        self.create_prediction_cards()\n    \n    def create_prediction_cards(self):\n        \"\"\"å‰µå»ºé æ¸¬å¡ç‰‡\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        # æ¸…ç©ºç¾æœ‰å…§å®¹\n        for i in reversed(range(self.prediction_layout.count())):\n            self.prediction_layout.itemAt(i).widget().setParent(None)\n        \n        # AIé æ¸¬å¡ç‰‡\n        ai_predictions = [\n            {\n                \"name\": \"ğŸš€ å¸‚å ´æƒæå“¡\",\n                \"prediction\": \"BUY\",\n                \"confidence\": 75.5,\n                \"reasoning\": \"æª¢æ¸¬åˆ°å¼·çƒˆçš„è²·å…¥ä¿¡è™Ÿï¼ŒRSIæŒ‡æ¨™é¡¯ç¤ºè¶…è³£ç‹€æ…‹\",\n                \"color\": \"#4CAF50\"\n            },\n            {\n                \"name\": \"ğŸ” æ·±åº¦åˆ†æå¸«\", \n                \"prediction\": \"BUY\",\n                \"confidence\": 82.3,\n                \"reasoning\": \"æŠ€è¡“åˆ†æé¡¯ç¤ºçªç ´é—œéµé˜»åŠ›ä½ï¼Œæˆäº¤é‡æ”¾å¤§\",\n                \"color\": \"#4CAF50\"\n            },\n            {\n                \"name\": \"ğŸ“ˆ è¶¨å‹¢åˆ†æå¸«\",\n                \"prediction\": \"HOLD\",\n                \"confidence\": 68.7,\n                \"reasoning\": \"çŸ­æœŸè¶¨å‹¢ä¸æ˜ç¢ºï¼Œå»ºè­°ç­‰å¾…æ›´æ¸…æ™°çš„ä¿¡è™Ÿ\",\n                \"color\": \"#FF9800\"\n            },\n            {\n                \"name\": \"âš ï¸ é¢¨éšªè©•ä¼°AI\",\n                \"prediction\": \"CAUTION\",\n                \"confidence\": 91.2,\n                \"reasoning\": \"å¸‚å ´æ³¢å‹•è¼ƒå¤§ï¼Œå»ºè­°é™ä½å€‰ä½æˆ–è¨­ç½®åš´æ ¼æ­¢æ\",\n                \"color\": \"#F44336\"\n            },\n            {\n                \"name\": \"ğŸ§  æœ€çµ‚æ±ºç­–è€…\",\n                \"prediction\": \"BUY\",\n                \"confidence\": 77.8,\n                \"reasoning\": \"ç¶œåˆåˆ†æå¾Œå»ºè­°å°å€‰ä½è²·å…¥ï¼Œåš´æ ¼æ§åˆ¶é¢¨éšª\",\n                \"color\": \"#2196F3\"\n            }\n        ]\n        \n        for pred in ai_predictions:\n            card = self.create_prediction_card(pred)\n            self.prediction_layout.addWidget(card)\n        \n        self.prediction_layout.addStretch()\n    \n    def create_prediction_card(self, prediction: Dict[str, Any]) -> QWidget:\n        \"\"\"å‰µå»ºå–®å€‹é æ¸¬å¡ç‰‡\"\"\"\n        if not PYQT_AVAILABLE:\n            return None\n            \n        card = QFrame()\n        card.setFrameStyle(QFrame.Shape.Box)\n        card.setStyleSheet(f\"\"\"\n            QFrame {{\n                border: 2px solid {prediction['color']};\n                border-radius: 8px;\n                padding: 10px;\n                margin: 5px;\n                background-color: white;\n            }}\n        \"\"\")\n        \n        layout = QVBoxLayout(card)\n        \n        # æ¨™é¡Œè¡Œ\n        title_layout = QHBoxLayout()\n        \n        name_label = QLabel(prediction['name'])\n        name_label.setFont(QFont(\"Arial\", 12, QFont.Weight.Bold))\n        title_layout.addWidget(name_label)\n        \n        title_layout.addStretch()\n        \n        # é æ¸¬çµæœ\n        pred_label = QLabel(prediction['prediction'])\n        pred_label.setFont(QFont(\"Arial\", 12, QFont.Weight.Bold))\n        pred_label.setStyleSheet(f\"color: {prediction['color']};\")\n        title_layout.addWidget(pred_label)\n        \n        layout.addLayout(title_layout)\n        \n        # ä¿¡å¿ƒåº¦é€²åº¦æ¢\n        confidence_layout = QHBoxLayout()\n        confidence_layout.addWidget(QLabel(\"ä¿¡å¿ƒåº¦:\"))\n        \n        confidence_bar = QProgressBar()\n        confidence_bar.setRange(0, 100)\n        confidence_bar.setValue(int(prediction['confidence']))\n        confidence_bar.setStyleSheet(f\"\"\"\n            QProgressBar::chunk {{\n                background-color: {prediction['color']};\n            }}\n        \"\"\")\n        confidence_layout.addWidget(confidence_bar)\n        \n        confidence_layout.addWidget(QLabel(f\"{prediction['confidence']:.1f}%\"))\n        layout.addLayout(confidence_layout)\n        \n        # æ¨ç†èªªæ˜\n        reasoning_label = QLabel(prediction['reasoning'])\n        reasoning_label.setWordWrap(True)\n        reasoning_label.setStyleSheet(\"color: #666; font-size: 10px;\")\n        layout.addWidget(reasoning_label)\n        \n        return card\n    \n    def on_pair_changed(self, pair: str):\n        \"\"\"äº¤æ˜“å°æ”¹è®Šäº‹ä»¶\"\"\"\n        logger.info(f\"åˆ‡æ›åˆ°äº¤æ˜“å°: {pair}\")\n        self.update_predictions()\n    \n    def update_predictions(self):\n        \"\"\"æ›´æ–°é æ¸¬çµæœ\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            # é‡æ–°å‰µå»ºé æ¸¬å¡ç‰‡ï¼ˆæ¨¡æ“¬æ›´æ–°ï¼‰\n            self.create_prediction_cards()\n            logger.info(\"âœ… AIé æ¸¬çµæœå·²æ›´æ–°\")\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ›´æ–°é æ¸¬çµæœå¤±æ•—: {e}\")\n\nclass ModelConfigWidget(QWidget if PYQT_AVAILABLE else object):\n    \"\"\"æ¨¡å‹é…ç½®çµ„ä»¶\"\"\"\n    \n    def __init__(self, parent=None):\n        if PYQT_AVAILABLE:\n            super().__init__(parent)\n        self.setup_ui()\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®UI\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        layout = QVBoxLayout(self)\n        \n        # æ¨™é¡Œ\n        title = QLabel(\"âš™ï¸ æ¨¡å‹åƒæ•¸é…ç½®\")\n        title.setFont(QFont(\"Arial\", 14, QFont.Weight.Bold))\n        layout.addWidget(title)\n        \n        # é…ç½®è¡¨å–®\n        form_layout = QFormLayout()\n        \n        # æ¨¡å‹é¸æ“‡\n        self.model_combo = QComboBox()\n        self.model_combo.addItems([\n            \"å¸‚å ´æƒæå“¡ (llama2:7b)\",\n            \"æ·±åº¦åˆ†æå¸« (falcon:7b)\", \n            \"è¶¨å‹¢åˆ†æå¸« (qwen:7b)\",\n            \"é¢¨éšªè©•ä¼°AI (mistral:7b)\",\n            \"æœ€çµ‚æ±ºç­–è€… (qwen:7b)\"\n        ])\n        form_layout.addRow(\"é¸æ“‡æ¨¡å‹:\", self.model_combo)\n        \n        # æº«åº¦åƒæ•¸\n        self.temperature_slider = QSlider(Qt.Orientation.Horizontal)\n        self.temperature_slider.setRange(1, 100)\n        self.temperature_slider.setValue(25)\n        self.temperature_label = QLabel(\"0.25\")\n        \n        temp_layout = QHBoxLayout()\n        temp_layout.addWidget(self.temperature_slider)\n        temp_layout.addWidget(self.temperature_label)\n        \n        self.temperature_slider.valueChanged.connect(\n            lambda v: self.temperature_label.setText(f\"{v/100:.2f}\")\n        )\n        \n        form_layout.addRow(\"æº«åº¦åƒæ•¸:\", temp_layout)\n        \n        # æœ€å¤§ä»¤ç‰Œæ•¸\n        self.max_tokens_spin = QSpinBox()\n        self.max_tokens_spin.setRange(100, 1000)\n        self.max_tokens_spin.setValue(400)\n        form_layout.addRow(\"æœ€å¤§ä»¤ç‰Œæ•¸:\", self.max_tokens_spin)\n        \n        # æ¬Šé‡\n        self.weight_slider = QSlider(Qt.Orientation.Horizontal)\n        self.weight_slider.setRange(1, 50)\n        self.weight_slider.setValue(25)\n        self.weight_label = QLabel(\"0.25\")\n        \n        weight_layout = QHBoxLayout()\n        weight_layout.addWidget(self.weight_slider)\n        weight_layout.addWidget(self.weight_label)\n        \n        self.weight_slider.valueChanged.connect(\n            lambda v: self.weight_label.setText(f\"{v/100:.2f}\")\n        )\n        \n        form_layout.addRow(\"æ±ºç­–æ¬Šé‡:\", weight_layout)\n        \n        # å•Ÿç”¨/ç¦ç”¨\n        self.enabled_checkbox = QCheckBox(\"å•Ÿç”¨æ­¤æ¨¡å‹\")\n        self.enabled_checkbox.setChecked(True)\n        form_layout.addRow(\"ç‹€æ…‹:\", self.enabled_checkbox)\n        \n        layout.addLayout(form_layout)\n        \n        # æ§åˆ¶æŒ‰éˆ•\n        button_layout = QHBoxLayout()\n        \n        self.apply_btn = QPushButton(\"âœ… æ‡‰ç”¨é…ç½®\")\n        self.apply_btn.clicked.connect(self.apply_configuration)\n        button_layout.addWidget(self.apply_btn)\n        \n        self.reset_btn = QPushButton(\"ğŸ”„ é‡ç½®é»˜èª\")\n        self.reset_btn.clicked.connect(self.reset_configuration)\n        button_layout.addWidget(self.reset_btn)\n        \n        button_layout.addStretch()\n        layout.addLayout(button_layout)\n        \n        layout.addStretch()\n    \n    def apply_configuration(self):\n        \"\"\"æ‡‰ç”¨é…ç½®\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        try:\n            config = {\n                \"model\": self.model_combo.currentText(),\n                \"temperature\": self.temperature_slider.value() / 100,\n                \"max_tokens\": self.max_tokens_spin.value(),\n                \"weight\": self.weight_slider.value() / 100,\n                \"enabled\": self.enabled_checkbox.isChecked()\n            }\n            \n            logger.info(f\"æ‡‰ç”¨æ¨¡å‹é…ç½®: {config}\")\n            QMessageBox.information(self, \"æˆåŠŸ\", \"é…ç½®å·²æ‡‰ç”¨\")\n            \n        except Exception as e:\n            logger.error(f\"âŒ æ‡‰ç”¨é…ç½®å¤±æ•—: {e}\")\n            QMessageBox.warning(self, \"éŒ¯èª¤\", f\"æ‡‰ç”¨é…ç½®å¤±æ•—: {e}\")\n    \n    def reset_configuration(self):\n        \"\"\"é‡ç½®é…ç½®\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        self.temperature_slider.setValue(25)\n        self.max_tokens_spin.setValue(400)\n        self.weight_slider.setValue(25)\n        self.enabled_checkbox.setChecked(True)\n        \n        QMessageBox.information(self, \"æˆåŠŸ\", \"é…ç½®å·²é‡ç½®ç‚ºé»˜èªå€¼\")\n\nclass ModernAITradingGUI(QMainWindow if PYQT_AVAILABLE else object):\n    \"\"\"ç¾ä»£åŒ–AIäº¤æ˜“ç³»çµ±GUIä¸»çª—å£\"\"\"\n    \n    def __init__(self):\n        if PYQT_AVAILABLE:\n            super().__init__()\n        \n        self.logger = logging.getLogger(__name__)\n        \n        # æ ¸å¿ƒçµ„ä»¶\n        self.ai_manager = None\n        self.max_client = None\n        self.risk_manager = None\n        \n        # GUIçµ„ä»¶\n        self.ai_status_widget = None\n        self.prediction_widget = None\n        self.config_widget = None\n        \n        # åˆå§‹åŒ–\n        self.setup_ui()\n        self.initialize_components()\n        \n        self.logger.info(\"ğŸš€ ç¾ä»£åŒ–AIäº¤æ˜“GUIåˆå§‹åŒ–å®Œæˆ\")\n    \n    def setup_ui(self):\n        \"\"\"è¨­ç½®ç”¨æˆ¶ç•Œé¢\"\"\"\n        if not PYQT_AVAILABLE:\n            self.logger.info(\"ğŸ–¥ï¸ GUIé‹è¡Œåœ¨æ–‡æœ¬æ¨¡å¼\")\n            return\n            \n        self.setWindowTitle(\"AImax - ç¾ä»£åŒ–AIäº¤æ˜“ç³»çµ±\")\n        self.setGeometry(100, 100, 1600, 1000)\n        \n        # æ‡‰ç”¨ç¾ä»£åŒ–æ¨£å¼\n        self.apply_modern_style()\n        \n        # å‰µå»ºä¸­å¤®çµ„ä»¶\n        central_widget = QWidget()\n        self.setCentralWidget(central_widget)\n        \n        # ä¸»ä½ˆå±€\n        main_layout = QHBoxLayout(central_widget)\n        \n        # å‰µå»ºåˆ†å‰²å™¨\n        splitter = QSplitter(Qt.Orientation.Horizontal)\n        \n        # å·¦å´é¢æ¿ - AIç‹€æ…‹å’Œé…ç½®\n        left_panel = QWidget()\n        left_layout = QVBoxLayout(left_panel)\n        \n        # AIæ¨¡å‹ç‹€æ…‹\n        self.ai_status_widget = AIModelStatusWidget()\n        left_layout.addWidget(self.ai_status_widget)\n        \n        # æ¨¡å‹é…ç½®\n        self.config_widget = ModelConfigWidget()\n        left_layout.addWidget(self.config_widget)\n        \n        splitter.addWidget(left_panel)\n        \n        # å³å´é¢æ¿ - é æ¸¬çµæœ\n        right_panel = QWidget()\n        right_layout = QVBoxLayout(right_panel)\n        \n        # AIé æ¸¬çµæœ\n        self.prediction_widget = AIPredictionWidget()\n        right_layout.addWidget(self.prediction_widget)\n        \n        splitter.addWidget(right_panel)\n        \n        # è¨­ç½®åˆ†å‰²æ¯”ä¾‹\n        splitter.setSizes([600, 1000])\n        \n        main_layout.addWidget(splitter)\n        \n        # å‰µå»ºç‹€æ…‹æ¬„\n        self.create_status_bar()\n    \n    def create_status_bar(self):\n        \"\"\"å‰µå»ºç‹€æ…‹æ¬„\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        status_bar = self.statusBar()\n        \n        # ç³»çµ±ç‹€æ…‹\n        self.system_status_label = QLabel(\"ğŸŸ¡ ç³»çµ±åˆå§‹åŒ–ä¸­...\")\n        status_bar.addWidget(self.system_status_label)\n        \n        # AIæ¨¡å‹è¨ˆæ•¸\n        self.ai_count_label = QLabel(\"AIæ¨¡å‹: 0/5\")\n        status_bar.addPermanentWidget(self.ai_count_label)\n        \n        # æ™‚é–“é¡¯ç¤º\n        self.time_label = QLabel()\n        status_bar.addPermanentWidget(self.time_label)\n        \n        # å®šæ™‚æ›´æ–°æ™‚é–“\n        self.time_timer = QTimer()\n        self.time_timer.timeout.connect(self.update_time_display)\n        self.time_timer.start(1000)\n    \n    def initialize_components(self):\n        \"\"\"åˆå§‹åŒ–çµ„ä»¶\"\"\"\n        try:\n            self.logger.info(\"ğŸ”„ åˆå§‹åŒ–AImaxçµ„ä»¶...\")\n            \n            if AIMAX_MODULES_AVAILABLE:\n                # åˆå§‹åŒ–AIç®¡ç†å™¨\n                self.ai_manager = EnhancedAIManager()\n                self.logger.info(\"âœ… AIç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ\")\n                \n                # åˆå§‹åŒ–MAXå®¢æˆ¶ç«¯\n                self.max_client = create_max_client()\n                self.logger.info(\"âœ… MAXå®¢æˆ¶ç«¯åˆå§‹åŒ–å®Œæˆ\")\n                \n                # åˆå§‹åŒ–é¢¨éšªç®¡ç†å™¨\n                self.risk_manager = create_risk_manager()\n                self.logger.info(\"âœ… é¢¨éšªç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ\")\n                \n                # è¨­ç½®AIç®¡ç†å™¨åˆ°ç‹€æ…‹çµ„ä»¶\n                if self.ai_status_widget:\n                    self.ai_status_widget.set_ai_manager(self.ai_manager)\n                \n                if PYQT_AVAILABLE:\n                    self.system_status_label.setText(\"ğŸŸ¢ ç³»çµ±é‹è¡Œæ­£å¸¸\")\n                    self.ai_count_label.setText(\"AIæ¨¡å‹: 5/5\")\n                \n            else:\n                self.logger.warning(\"âš ï¸ ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼\")\n                if PYQT_AVAILABLE:\n                    self.system_status_label.setText(\"ğŸŸ¡ æ¨¡æ“¬æ¨¡å¼\")\n                    self.ai_count_label.setText(\"AIæ¨¡å‹: æ¨¡æ“¬\")\n            \n            self.logger.info(\"âœ… æ‰€æœ‰çµ„ä»¶åˆå§‹åŒ–å®Œæˆ\")\n            \n        except Exception as e:\n            self.logger.error(f\"âŒ çµ„ä»¶åˆå§‹åŒ–å¤±æ•—: {e}\")\n            if PYQT_AVAILABLE:\n                self.system_status_label.setText(\"ğŸ”´ åˆå§‹åŒ–å¤±æ•—\")\n                QMessageBox.critical(self, \"åˆå§‹åŒ–éŒ¯èª¤\", f\"çµ„ä»¶åˆå§‹åŒ–å¤±æ•—: {e}\")\n    \n    def update_time_display(self):\n        \"\"\"æ›´æ–°æ™‚é–“é¡¯ç¤º\"\"\"\n        if PYQT_AVAILABLE:\n            current_time = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n            self.time_label.setText(current_time)\n    \n    def apply_modern_style(self):\n        \"\"\"æ‡‰ç”¨ç¾ä»£åŒ–æ¨£å¼\"\"\"\n        if not PYQT_AVAILABLE:\n            return\n            \n        style = \"\"\"\n        QMainWindow {\n            background-color: #f8f9fa;\n        }\n        \n        QWidget {\n            font-family: 'Segoe UI', Arial, sans-serif;\n        }\n        \n        QGroupBox {\n            font-weight: bold;\n            border: 2px solid #dee2e6;\n            border-radius: 8px;\n            margin-top: 10px;\n            padding-top: 10px;\n        }\n        \n        QGroupBox::title {\n            subcontrol-origin: margin;\n            left: 10px;\n            padding: 0 5px 0 5px;\n        }\n        \n        QPushButton {\n            background-color: #007bff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 6px;\n            font-weight: bold;\n            min-width: 100px;\n        }\n        \n        QPushButton:hover {\n            background-color: #0056b3;\n        }\n        \n        QPushButton:pressed {\n            background-color: #004085;\n        }\n        \n        QTableWidget {\n            gridline-color: #dee2e6;\n            background-color: white;\n            alternate-background-color: #f8f9fa;\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n        }\n        \n        QTableWidget::item {\n            padding: 8px;\n        }\n        \n        QHeaderView::section {\n            background-color: #e9ecef;\n            padding: 8px;\n            border: none;\n            font-weight: bold;\n        }\n        \n        QComboBox {\n            border: 1px solid #ced4da;\n            border-radius: 4px;\n            padding: 6px;\n            background-color: white;\n        }\n        \n        QComboBox:hover {\n            border-color: #80bdff;\n        }\n        \n        QProgressBar {\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n            text-align: center;\n        }\n        \n        QProgressBar::chunk {\n            background-color: #28a745;\n            border-radius: 3px;\n        }\n        \n        QSlider::groove:horizontal {\n            border: 1px solid #dee2e6;\n            height: 6px;\n            background: #f8f9fa;\n            border-radius: 3px;\n        }\n        \n        QSlider::handle:horizontal {\n            background: #007bff;\n            border: 1px solid #0056b3;\n            width: 18px;\n            margin: -6px 0;\n            border-radius: 9px;\n        }\n        \n        QStatusBar {\n            background-color: #e9ecef;\n            border-top: 1px solid #dee2e6;\n        }\n        \n        QScrollArea {\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n            background-color: white;\n        }\n        \"\"\"\n        \n        self.setStyleSheet(style)\n    \n    def closeEvent(self, event):\n        \"\"\"é—œé–‰äº‹ä»¶\"\"\"\n        try:\n            self.logger.info(\"ğŸ”„ æ­£åœ¨é—œé–‰æ‡‰ç”¨ç¨‹åº...\")\n            \n            # åœæ­¢å®šæ™‚å™¨\n            if hasattr(self, 'time_timer'):\n                self.time_timer.stop()\n            \n            # æ¸…ç†è³‡æº\n            if self.ai_manager:\n                # é€™è£¡å¯ä»¥æ·»åŠ AIç®¡ç†å™¨çš„æ¸…ç†ä»£ç¢¼\n                pass\n            \n            self.logger.info(\"âœ… æ‡‰ç”¨ç¨‹åºæ­£å¸¸é—œé–‰\")\n            \n        except Exception as e:\n            self.logger.error(f\"âŒ é—œé–‰æ‡‰ç”¨ç¨‹åºæ™‚ç™¼ç”ŸéŒ¯èª¤: {e}\")\n        \n        event.accept()\n\ndef main():\n    \"\"\"ä¸»å‡½æ•¸\"\"\"\n    # è¨­ç½®æ—¥èªŒ\n    logging.basicConfig(\n        level=logging.INFO,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[\n            logging.FileHandler('AImax/logs/modern_gui.log', encoding='utf-8'),\n            logging.StreamHandler()\n        ]\n    )\n    \n    logger = logging.getLogger(__name__)\n    logger.info(\"ğŸš€ å•Ÿå‹•ç¾ä»£åŒ–AIäº¤æ˜“GUI\")\n    \n    if PYQT_AVAILABLE:\n        app = QApplication(sys.argv)\n        app.setApplicationName(\"AImax Modern GUI\")\n        app.setApplicationVersion(\"2.0.0\")\n        \n        # å‰µå»ºä¸»çª—å£\n        main_window = ModernAITradingGUI()\n        main_window.show()\n        \n        # é‹è¡Œæ‡‰ç”¨ç¨‹åº\n        sys.exit(app.exec())\n    else:\n        # æ–‡æœ¬æ¨¡å¼\n        logger.info(\"ğŸ–¥ï¸ é‹è¡Œåœ¨æ–‡æœ¬æ¨¡å¼\")\n        main_window = ModernAITradingGUI()\n        \n        try:\n            while True:\n                time.sleep(1)\n        except KeyboardInterrupt:\n            logger.info(\"â¹ï¸ ç”¨æˆ¶ä¸­æ–·ï¼Œæ­£åœ¨é—œé–‰...\")\n\nif __name__ == \"__main__\":\n    main()\n"