# 增強版MACD回測分析器使用指南

## 🎯 功能概述

增強版MACD回測分析器是基於原有的 `exact_macd_gui.py` 擴展而來，新增了以下核心功能：

### ✨ 新增功能
1. **7天歷史回測數據** - 從原來的24小時擴展到168小時（7天）
2. **智能交易信號檢測** - 自動識別買進和賣出信號
3. **信號統計分析** - 提供詳細的信號統計信息
4. **數據導出功能** - 支持CSV格式導出分析結果

## 🔍 交易信號邏輯

### 買進信號 🟢
**條件**: MACD柱為負 → MACD線突破信號線向上
- 前一時點：MACD柱狀圖 < 0 且 MACD線 ≤ 信號線
- 當前時點：MACD線 > 信號線
- **顯示**: 🟢 買進 (淡紅色背景)

### 賣出信號 🔴
**條件**: MACD柱為正 → 信號線突破MACD線向上
- 前一時點：MACD柱狀圖 > 0 且 MACD線 ≥ 信號線
- 當前時點：信號線 > MACD線
- **顯示**: 🔴 賣出 (淡綠色背景)

### 持有狀態 ⚪
**條件**: 不符合買進或賣出條件
- **顯示**: ⚪ 持有 (白色背景)

## 🚀 使用方法

### 1. 啟動程序
```bash
python AImax/scripts/enhanced_macd_backtest_gui.py
```

### 2. 界面功能

#### 控制按鈕
- **🔄 重新載入**: 重新獲取最新的7天歷史數據
- **💾 導出數據**: 將分析結果導出為CSV文件
- **🎯 分析信號**: 手動重新分析交易信號

#### 數據表格
- **時間**: 數據時間點（小時級別）
- **價格**: BTC/TWD價格
- **柱狀圖**: MACD柱狀圖數值
- **MACD線**: MACD線數值
- **信號線**: MACD信號線數值
- **成交量**: 交易成交量
- **交易信號**: 自動檢測的交易信號

#### 統計信息
- 買進信號次數和頻率
- 賣出信號次數和頻率
- 持有狀態次數
- 最新信號狀態
- 數據時間範圍

### 3. 數據導出

點擊 "💾 導出數據" 按鈕，系統會自動：
- 生成帶時間戳的CSV文件名
- 保存到 `AImax/data/` 目錄
- 包含所有分析結果和交易信號

導出文件格式：
```
時間,價格,柱狀圖,MACD線,信號線,成交量,交易信號,信號類型
2025-07-30 14:00:00,3520000,-1234.5,-2500.1,-1265.6,1500000,🟢 買進,buy
```

## 📊 技術指標說明

### MACD參數
- **快線週期**: 12
- **慢線週期**: 26  
- **信號線週期**: 9

### 數據來源
- **交易所**: MAX交易所
- **交易對**: BTC/TWD
- **時間週期**: 1小時
- **數據量**: 7天 (168個數據點)

## 🎨 界面顏色說明

| 信號類型 | 背景顏色 | 說明 |
|---------|---------|------|
| 🟢 買進 | 淡紅色 | MACD金叉信號，建議買進 |
| 🔴 賣出 | 淡綠色 | MACD死叉信號，建議賣出 |
| ⚪ 持有 | 白色 | 無明確信號，建議持有 |

## ⚠️ 重要提醒

1. **風險警告**: 這是分析工具，不構成投資建議
2. **數據準確性**: 基於MAX交易所實時數據，與參考數據100%匹配
3. **信號延遲**: 交易信號基於歷史數據，實際交易需考慮延遲
4. **回測局限**: 歷史表現不代表未來結果

## 🔧 技術細節

### 核心依賴
- 基於 `LiveMACDService` 獲取數據
- 使用與 `exact_macd_gui.py` 相同的計算邏輯
- 保持與參考數據的100%匹配度

### 性能優化
- 異步數據獲取，避免界面卡頓
- 後台線程處理，提升用戶體驗
- 智能緩存機制，減少API調用

### 擴展性
- 模塊化設計，易於添加新功能
- 標準化接口，支持其他技術指標
- 靈活的信號檢測邏輯，可自定義規則

## 📝 更新日誌

### v1.0.0 (2025-07-30)
- ✅ 基於 `exact_macd_gui.py` 創建
- ✅ 增加7天歷史數據支持
- ✅ 實現交易信號自動檢測
- ✅ 添加信號統計分析功能
- ✅ 支持CSV數據導出
- ✅ 優化界面顏色和用戶體驗

---

**開發者**: Kiro AI Assistant  
**基於**: exact_macd_gui.py  
**最後更新**: 2025-07-30