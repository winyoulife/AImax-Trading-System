name: 部署AImax簡潔版儀表板到GitHub Pages

on:
  push:
    branches: [ main ]
    paths:
      - 'static/clean-dashboard.html'
      - 'static/simple-max-dashboard.html'
      - 'static/test-max-api.html'
      - '.github/workflows/deploy-pages.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 🔄 檢出代碼
        uses: actions/checkout@v4
        
      - name: 🔧 設置Pages
        uses: actions/configure-pages@v4
        
      - name: 📦 準備簡潔版儀表板部署文件
        run: |
          echo "📦 準備AImax v3.0簡潔版儀表板..."
          
          # 創建部署目錄
          mkdir -p _site
          
          # 複製修復版安全登入頁面作為主頁
          cp static/secure-login-fixed.html _site/index.html
          
          # 複製修復版終極智能儀表板
          cp static/dashboard-fixed.html _site/dashboard.html
          
          # 複製測試頁面
          cp static/test-max-api.html _site/test-max-api.html
          
          # 複製各版本儀表板作為備用
          cp static/clean-dashboard.html _site/clean.html
          cp static/simple-max-dashboard.html _site/simple.html
          cp static/ultimate-smart-dashboard.html _site/smart.html
          
          # 複製修復版本作為備用
          cp static/secure-login-fixed.html _site/login-fixed.html
          cp static/dashboard-fixed.html _site/dashboard-fixed.html
          
          # 複製登入測試頁面
          cp static/test-login-only.html _site/test-login.html
          
          # 複製JavaScript模組
          mkdir -p _site/js
          cp static/js/github-actions-monitor.js _site/js/
          
          # 創建重定向頁面
          cat > _site/login.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <meta http-equiv="refresh" content="0; url=./dashboard.html">
              <title>重定向到 AImax 登入頁面</title>
          </head>
          <body>
              <p>正在重定向到 <a href="./dashboard.html">AImax 登入頁面</a>...</p>
          </body>
          </html>
          EOF
          
          # 創建說明頁面
          cat > _site/README.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-TW">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>AImax v3.0 簡潔版交易儀表板</title>
              <style>
                  body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                  .header { background: #6c5ce7; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                  .card { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                  .btn { display: inline-block; background: #00b894; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 10px 0; }
                  .btn:hover { background: #00a085; }
                  .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin: 20px 0; }
              </style>
          </head>
          <body>
              <div class="header">
                  <h1>🤖 AImax 終極智能交易儀表板</h1>
                  <p>85%勝率策略 • 高頻智能交易系統 • 即時數據監控</p>
              </div>
              
              <div class="card">
                  <h2>🔐 安全登入</h2>
                  <a href="./index.html" class="btn">🔑 專屬安全登入</a>
                  <a href="./dashboard.html" class="btn">🤖 終極智能儀表板</a>
                  <a href="./test-login.html" class="btn">🧪 登入系統測試</a>
                  <a href="./simple.html" class="btn">💰 簡潔價格顯示</a>
                  <p><strong>專屬帳號登入資訊：</strong></p>
                  <ul>
                      <li>專屬帳號：<code>lovejk1314</code></li>
                      <li>專屬密碼：<code>Ichen5978</code></li>
                      <li>安全等級：<code>SHA-256加密</code></li>
                  </ul>
              </div>
              
              <div class="card">
                  <h2>🛡️ 安全功能特色</h2>
                  <ul>
                      <li>🔐 專屬帳號密碼認證系統</li>
                      <li>🛡️ SHA-256加密技術保護</li>
                      <li>⏰ 24小時會話管理</li>
                      <li>🚪 安全登出機制</li>
                      <li>🤖 85%勝率高頻交易系統</li>
                      <li>💰 MAX API 即時價格監控</li>
                      <li>📊 完整系統狀態顯示</li>
                      <li>📱 Telegram即時通知</li>
                  </ul>
              </div>
              
              <div class="warning">
                  <h3>⚠️ 重要提醒</h3>
                  <ul>
                      <li>此為私有交易系統，僅限授權用戶使用</li>
                      <li>價格數據直接來自 MAX Exchange 官方 API</li>
                      <li>85%勝率交易策略已啟用並受到保護</li>
                      <li>請勿在公共網路環境下使用</li>
                  </ul>
              </div>
              
              <div class="card">
                  <h2>🔗 相關連結</h2>
                  <ul>
                      <li><a href="https://github.com/winyoulife/AImax-Trading-System">GitHub 專案</a></li>
                      <li><a href="https://max.maicoin.com/documents/api">MAX API 文檔</a></li>
                  </ul>
              </div>
          </body>
          </html>
          EOF
          
          # 確保robots.txt存在並禁止索引
          echo "# AImax 私有交易系統 - 禁止所有搜索引擎索引" > _site/robots.txt
          echo "User-agent: *" >> _site/robots.txt
          echo "Disallow: /" >> _site/robots.txt
          echo "Crawl-delay: 86400" >> _site/robots.txt
          
          # 創建.nojekyll文件
          touch _site/.nojekyll
          
          echo "✅ 簡潔版儀表板部署文件準備完成"
          echo "📁 部署文件列表:"
          ls -la _site/
          
      - name: 📤 上傳Pages構建產物
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: 🚀 部署到GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: ✅ 部署完成通知
        run: |
          echo "🎉 AImax MAX API 直連版儀表板部署完成！"
          echo "🌐 主頁 (即時價格): ${{ steps.deployment.outputs.page_url }}"
          echo "🔐 完整儀表板: ${{ steps.deployment.outputs.page_url }}dashboard.html"
          echo "📊 登入帳號: admin / 密碼: aimax2025"
          echo "💰 MAX API: 直接連接，無需代理"