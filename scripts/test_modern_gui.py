#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\næ¸¬è©¦ç¾ä»£åŒ–AIäº¤æ˜“GUIç³»çµ±\n\"\"\"\n\nimport sys\nimport os\nimport logging\nimport time\nfrom pathlib import Path\n\n# æ·»åŠ é …ç›®æ ¹ç›®éŒ„åˆ°è·¯å¾‘\nsys.path.append(str(Path(__file__).parent.parent))\n\ndef setup_logging():\n    \"\"\"è¨­ç½®æ—¥èªŒ\"\"\"\n    log_dir = Path(\"AImax/logs\")\n    log_dir.mkdir(exist_ok=True)\n    \n    logging.basicConfig(\n        level=logging.INFO,\n        format='%(asctime)s - %(levelname)s - %(message)s',\n        handlers=[\n            logging.FileHandler(log_dir / 'test_modern_gui.log', encoding='utf-8', mode='w'),\n            logging.StreamHandler()\n        ]\n    )\n\ndef check_dependencies():\n    \"\"\"æª¢æŸ¥ä¾è³´\"\"\"\n    print(\"ğŸ” æª¢æŸ¥GUIä¾è³´...\")\n    \n    missing_deps = []\n    \n    try:\n        import PyQt6\n        print(\"âœ… PyQt6 å·²å®‰è£\")\n    except ImportError:\n        missing_deps.append(\"PyQt6\")\n    \n    try:\n        import matplotlib\n        print(\"âœ… matplotlib å·²å®‰è£\")\n    except ImportError:\n        missing_deps.append(\"matplotlib\")\n    \n    if missing_deps:\n        print(f\"âŒ ç¼ºå°‘ä¾è³´: {', '.join(missing_deps)}\")\n        print(f\"è«‹é‹è¡Œ: pip install {' '.join(missing_deps)}\")\n        return False\n    \n    print(\"âœ… æ‰€æœ‰GUIä¾è³´æª¢æŸ¥é€šé\")\n    return True\n\ndef test_gui_components():\n    \"\"\"æ¸¬è©¦GUIçµ„ä»¶\"\"\"\n    print(\"\\nğŸ§ª æ¸¬è©¦GUIçµ„ä»¶...\")\n    \n    try:\n        from src.gui.modern_ai_trading_gui import (\n            AIModelStatusWidget, AIPredictionWidget, ModelConfigWidget\n        )\n        \n        print(\"âœ… AIæ¨¡å‹ç‹€æ…‹çµ„ä»¶å°å…¥æˆåŠŸ\")\n        print(\"âœ… AIé æ¸¬çµæœçµ„ä»¶å°å…¥æˆåŠŸ\")\n        print(\"âœ… æ¨¡å‹é…ç½®çµ„ä»¶å°å…¥æˆåŠŸ\")\n        \n        return True\n        \n    except ImportError as e:\n        print(f\"âŒ GUIçµ„ä»¶å°å…¥å¤±æ•—: {e}\")\n        return False\n    except Exception as e:\n        print(f\"âŒ GUIçµ„ä»¶æ¸¬è©¦å¤±æ•—: {e}\")\n        return False\n\ndef test_ai_integration():\n    \"\"\"æ¸¬è©¦AIæ•´åˆ\"\"\"\n    print(\"\\nğŸ¤– æ¸¬è©¦AIæ•´åˆ...\")\n    \n    try:\n        # æ¸¬è©¦AIç®¡ç†å™¨å°å…¥\n        from src.ai.enhanced_ai_manager import EnhancedAIManager\n        print(\"âœ… AIç®¡ç†å™¨å°å…¥æˆåŠŸ\")\n        \n        # æ¸¬è©¦å‰µå»ºAIç®¡ç†å™¨\n        ai_manager = EnhancedAIManager()\n        print(\"âœ… AIç®¡ç†å™¨å‰µå»ºæˆåŠŸ\")\n        \n        return True\n        \n    except ImportError as e:\n        print(f\"âš ï¸ AIæ¨¡å¡Šå°å…¥å¤±æ•—ï¼ˆå°‡ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼ï¼‰: {e}\")\n        return True  # æ¨¡æ“¬æ¨¡å¼ä¹Ÿç®—æˆåŠŸ\n    except Exception as e:\n        print(f\"âŒ AIæ•´åˆæ¸¬è©¦å¤±æ•—: {e}\")\n        return False\n\ndef run_gui_test():\n    \"\"\"é‹è¡ŒGUIæ¸¬è©¦\"\"\"\n    print(\"\\nğŸ–¥ï¸ å•Ÿå‹•GUIæ¸¬è©¦...\")\n    \n    try:\n        from PyQt6.QtWidgets import QApplication\n        from src.gui.modern_ai_trading_gui import ModernAITradingGUI\n        \n        # å‰µå»ºæ‡‰ç”¨ç¨‹åº\n        app = QApplication([])\n        \n        # å‰µå»ºä¸»çª—å£\n        main_window = ModernAITradingGUI()\n        \n        print(\"âœ… GUIä¸»çª—å£å‰µå»ºæˆåŠŸ\")\n        \n        # é¡¯ç¤ºçª—å£\n        main_window.show()\n        print(\"âœ… GUIçª—å£é¡¯ç¤ºæˆåŠŸ\")\n        \n        # æ¸¬è©¦çµ„ä»¶åŠŸèƒ½\n        if hasattr(main_window, 'ai_status_widget'):\n            print(\"âœ… AIç‹€æ…‹çµ„ä»¶å·²åŠ è¼‰\")\n        \n        if hasattr(main_window, 'prediction_widget'):\n            print(\"âœ… é æ¸¬çµæœçµ„ä»¶å·²åŠ è¼‰\")\n        \n        if hasattr(main_window, 'config_widget'):\n            print(\"âœ… é…ç½®çµ„ä»¶å·²åŠ è¼‰\")\n        \n        # çŸ­æš«é‹è¡ŒGUI\n        print(\"\\nâ° GUIå°‡é‹è¡Œ5ç§’å¾Œè‡ªå‹•é—œé–‰...\")\n        \n        from PyQt6.QtCore import QTimer\n        \n        # 5ç§’å¾Œè‡ªå‹•é—œé–‰\n        close_timer = QTimer()\n        close_timer.setSingleShot(True)\n        close_timer.timeout.connect(app.quit)\n        close_timer.start(5000)\n        \n        # é‹è¡Œäº‹ä»¶å¾ªç’°\n        result = app.exec()\n        \n        print(\"âœ… GUIæ¸¬è©¦å®Œæˆ\")\n        return result == 0\n        \n    except ImportError as e:\n        print(f\"âŒ GUIæ¸¬è©¦å¤±æ•—ï¼ˆPyQt6æœªå®‰è£ï¼‰: {e}\")\n        return False\n    except Exception as e:\n        print(f\"âŒ GUIæ¸¬è©¦å¤±æ•—: {e}\")\n        return False\n\ndef run_text_mode_test():\n    \"\"\"é‹è¡Œæ–‡æœ¬æ¨¡å¼æ¸¬è©¦\"\"\"\n    print(\"\\nğŸ“ é‹è¡Œæ–‡æœ¬æ¨¡å¼æ¸¬è©¦...\")\n    \n    try:\n        from src.gui.modern_ai_trading_gui import ModernAITradingGUI\n        \n        # å‰µå»ºGUIå¯¦ä¾‹ï¼ˆæ–‡æœ¬æ¨¡å¼ï¼‰\n        gui = ModernAITradingGUI()\n        \n        print(\"âœ… æ–‡æœ¬æ¨¡å¼GUIå‰µå»ºæˆåŠŸ\")\n        \n        # æ¸¬è©¦çµ„ä»¶åˆå§‹åŒ–\n        if hasattr(gui, 'ai_manager'):\n            print(\"âœ… AIç®¡ç†å™¨å·²åˆå§‹åŒ–\")\n        \n        print(\"âœ… æ–‡æœ¬æ¨¡å¼æ¸¬è©¦å®Œæˆ\")\n        return True\n        \n    except Exception as e:\n        print(f\"âŒ æ–‡æœ¬æ¨¡å¼æ¸¬è©¦å¤±æ•—: {e}\")\n        return False\n\ndef main():\n    \"\"\"ä¸»å‡½æ•¸\"\"\"\n    print(\"ğŸš€ ç¾ä»£åŒ–AIäº¤æ˜“GUIæ¸¬è©¦\")\n    print(\"=\" * 50)\n    \n    # è¨­ç½®æ—¥èªŒ\n    setup_logging()\n    \n    # æ¸¬è©¦çµæœçµ±è¨ˆ\n    test_results = []\n    \n    # 1. æª¢æŸ¥ä¾è³´\n    test_results.append((\"ä¾è³´æª¢æŸ¥\", check_dependencies()))\n    \n    # 2. æ¸¬è©¦GUIçµ„ä»¶\n    test_results.append((\"GUIçµ„ä»¶\", test_gui_components()))\n    \n    # 3. æ¸¬è©¦AIæ•´åˆ\n    test_results.append((\"AIæ•´åˆ\", test_ai_integration()))\n    \n    # 4. é‹è¡ŒGUIæ¸¬è©¦ï¼ˆå¦‚æœPyQt6å¯ç”¨ï¼‰\n    try:\n        import PyQt6\n        test_results.append((\"GUIé‹è¡Œæ¸¬è©¦\", run_gui_test()))\n    except ImportError:\n        print(\"âš ï¸ PyQt6æœªå®‰è£ï¼Œè·³éGUIé‹è¡Œæ¸¬è©¦\")\n        test_results.append((\"æ–‡æœ¬æ¨¡å¼æ¸¬è©¦\", run_text_mode_test()))\n    \n    # è¼¸å‡ºæ¸¬è©¦çµæœ\n    print(\"\\nğŸ“Š æ¸¬è©¦çµæœçµ±è¨ˆ:\")\n    print(\"-\" * 40)\n    \n    passed_tests = 0\n    total_tests = len(test_results)\n    \n    for test_name, result in test_results:\n        status = \"âœ… é€šé\" if result else \"âŒ å¤±æ•—\"\n        print(f\"   {test_name}: {status}\")\n        if result:\n            passed_tests += 1\n    \n    success_rate = passed_tests / total_tests\n    print(f\"\\nğŸ“Š æ¸¬è©¦æˆåŠŸç‡: {success_rate:.1%} ({passed_tests}/{total_tests})\")\n    \n    # ç³»çµ±å¥åº·åº¦è©•ä¼°\n    if success_rate >= 0.9:\n        health_status = \"å„ªç§€\"\n    elif success_rate >= 0.7:\n        health_status = \"è‰¯å¥½\"\n    elif success_rate >= 0.5:\n        health_status = \"ä¸€èˆ¬\"\n    else:\n        health_status = \"éœ€æ”¹é€²\"\n    \n    print(f\"   ç³»çµ±å¥åº·åº¦: {health_status}\")\n    \n    # åŠŸèƒ½ç‰¹è‰²å±•ç¤º\n    print(\"\\nğŸ¯ GUIåŠŸèƒ½ç‰¹è‰²:\")\n    print(\"-\" * 40)\n    print(\"   ğŸ§  AIæ¨¡å‹ç‹€æ…‹å¯¦æ™‚ç›£æ§\")\n    print(\"   ğŸ”® AIé æ¸¬çµæœå¯è¦–åŒ–å±•ç¤º\")\n    print(\"   âš™ï¸ æ¨¡å‹åƒæ•¸å‹•æ…‹é…ç½®\")\n    print(\"   ğŸ“Š ç¾ä»£åŒ–ç•Œé¢è¨­è¨ˆ\")\n    print(\"   ğŸ”„ å¯¦æ™‚æ•¸æ“šæ›´æ–°\")\n    print(\"   ğŸ›¡ï¸ éŒ¯èª¤è™•ç†å’Œæ¢å¾©\")\n    \n    print(f\"\\nğŸ¯ ç¾ä»£åŒ–AIäº¤æ˜“GUIæ¸¬è©¦å®Œæˆï¼\")\n    print(\"=\" * 50)\n    \n    return {\n        'test_successful': success_rate >= 0.7,\n        'total_tests': total_tests,\n        'passed_tests': passed_tests,\n        'success_rate': success_rate,\n        'system_health': health_status\n    }\n\nif __name__ == \"__main__\":\n    try:\n        result = main()\n        \n        # è¼¸å‡ºæœ€çµ‚çµæœ\n        print(f\"\\nğŸ† æœ€çµ‚æ¸¬è©¦çµæœ:\")\n        print(f\"   æ¸¬è©¦æˆåŠŸ: {'âœ…' if result['test_successful'] else 'âŒ'}\")\n        print(f\"   é€šéæ¸¬è©¦: {result['passed_tests']}/{result['total_tests']}\")\n        print(f\"   æˆåŠŸç‡: {result['success_rate']:.1%}\")\n        print(f\"   ç³»çµ±å¥åº·åº¦: {result['system_health']}\")\n        \n        # é€€å‡ºç¢¼\n        exit_code = 0 if result['test_successful'] else 1\n        sys.exit(exit_code)\n        \n    except KeyboardInterrupt:\n        print(\"\\nâ¹ï¸ ç”¨æˆ¶ä¸­æ–·æ¸¬è©¦\")\n        sys.exit(1)\n    except Exception as e:\n        print(f\"\\nâŒ æ¸¬è©¦éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: {e}\")\n        sys.exit(1)\n"